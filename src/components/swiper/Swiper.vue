<script>
import { useModal } from '@/composables/modal';
import { useMovieTrailer } from '@/composables/movieTrailer';
import { useProfileMovieList } from '@/composables/profileMovieList';
import { Swiper, SwiperSlide } from 'swiper/vue';
import { Navigation } from 'swiper';
import 'swiper/css';
import 'swiper/css/navigation';
import MovieModal from '@/components/ui/movie-modal/MovieModal.vue';
import MovieTrailerOverlay from '@/components/ui/movie-modal/ModalTrailerOverlay.vue';
import Backdrop from '@/components/ui/movie-modal/Backdrop.vue';

export default {
  components: {
    Swiper,
    SwiperSlide,
    MovieModal,
    Backdrop,
    MovieTrailerOverlay,
  },

  props: {
    movieData: Object,
    heading: String,
  },

  setup(props) {
    const { isMovieModalOpen, clickedMovie, openModal, closeModals } =
      useModal();

    const { openMovieTrailerModal, closeMovieTrailerModal, isBackdropOpen } =
      useMovieTrailer();

    const { addToProfileList, deleteFromProfileList, isMovieInUserList } =
      useProfileMovieList();

    return {
      modules: [Navigation],
      props,
      addToProfileList,
      deleteFromProfileList,
      isMovieInUserList,
      openModal,
      isMovieModalOpen,
      clickedMovie,
      openMovieTrailerModal,
      closeMovieTrailerModal,
      isBackdropOpen,
      closeModals,
    };
  },
};
</script>

<template>
  <div :class="classes.swiper">
    <div>
      <h3 :class="classes.swiperHeading">{{ props.heading }}</h3>
    </div>
    <swiper
      :navigation="true"
      :modules="modules"
      class="mySwiper"
      :slidesPerView="2"
      :space-between="20"
      :breakpoints="{
        '630': {
          slidesPerView: 3,
          spaceBetween: 50,
        },

        '1280': {
          slidesPerView: 5,
          spaceBetween: 50,
        },
      }"
    >
      <swiper-slide v-for="movie in movieData" :key="movie.id">
        <img
          :src="`https://image.tmdb.org/t/p/w300${movie.poster_path}`"
          alt="movie poster"
        />
        <div :class="classes.swiperOverlay">
          <h4 :class="classes.movieHeading">{{ movie.original_title }}</h4>
          <h5>Release: {{ movie.release_date }}</h5>
          <div :class="classes.overlayIcons">
            <font-awesome-icon
              icon="play"
              :class="classes.swiperIcon"
              @click="openMovieTrailerModal(movie)"
            />
            <font-awesome-icon
              icon="plus-square"
              :class="classes.swiperIcon"
              v-if="!isMovieInUserList(movie)"
              @click="addToProfileList(movie)"
            />
            <font-awesome-icon
              icon="times-circle"
              :class="classes.swiperIcon"
              v-else
              @click="deleteFromProfileList(movie)"
            />
            <font-awesome-icon
              icon="info-circle"
              :class="classes.swiperIcon"
              @click="openModal(movie)"
            />
          </div>
        </div>
      </swiper-slide>
    </swiper>
  </div>
  <MovieModal
    @onCloseModals="closeModals"
    v-if="isMovieModalOpen"
    :clickedMovie="clickedMovie"
  />
  <teleport to="#backdrop-root">
    <Backdrop v-if="isBackdropOpen" @onCloseModals="closeMovieTrailerModal" />
  </teleport>
  <teleport to="#overlay-root">
    <MovieTrailerOverlay
      v-if="isBackdropOpen"
      @onCloseMovieTrailerOverlay="closeMovieTrailerModal"
  /></teleport>
</template>

<style lang="scss" module="classes">
@use '@/sass/components/swiper/swiper';
</style>
